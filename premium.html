<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="color-scheme" content="dark light"/>
  <title>å®Œå…¨ç‰ˆãƒ¬ãƒãƒ¼ãƒˆ | 16BodyPersonalities</title>

  <!-- favicon 404 å›é¿ -->
  <link rel="icon" href="data:,">

  <!-- ãƒ•ã‚©ãƒ³ãƒˆ & CSSï¼ˆappã¨åŒã˜è¦‹ãŸç›®ã«æƒãˆã‚‹ï¼‰ -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="./styles.css?v=2"/>
  <link rel="stylesheet" href="./premium.css?v=1"/>
  <style>
  body {
    background:#fafafa;
    font-family:"Inter", -apple-system, BlinkMacSystemFont, sans-serif;
  }
  .premium-wrap {
    max-width: 860px;
    margin: 0 auto;
    padding: 24px;
  }

  .hero {
    text-align:center;
    padding:24px 0;
  }
  .hero img.logo {
    width:140px;
    opacity:1;
    transition: opacity .4s;
  }

  .hero h1 {
    margin-top:12px;
    font-size:28px;
    font-weight:800;
    color:#222;
  }

  /* çµæœãƒ–ãƒ­ãƒƒã‚¯ã‚’é«˜ç´šæ„Ÿ */
  .premium-card {
    background:white;
    border-radius:20px;
    padding:28px;
    margin-top:24px;
    box-shadow:0 6px 20px rgba(0,0,0,0.08);
  }

  /* ç”»åƒãŒé»’èƒŒæ™¯ã«ãªã‚‰ãªã„ã‚ˆã†ã« */
  .type-image {
    width:100%;
    background:white;
    border-radius:20px;
    margin:16px 0;
  }

  /* Body Tips ã‚«ãƒ¼ãƒ‰ã®èƒŒæ™¯ */
  .cute-tips {
    background:white;
    border:1px solid #eee;
    border-radius:18px;
  }

  /* è¦‹å‡ºã—èª¿æ•´ */
  .premium-card h2 {
    font-size:22px;
    color:#222;
    font-weight:700;
    margin-bottom:12px;
  }

  .premium-card h3,
  .cute-tips h3 {
    color:#333;
    font-weight:700;
  }

  .tips-col h4 {
    color:#444;
  }

  .goal,
  .label,
  li,
  p {
    color:#333;
  }
</style>
</head>

<body data-page="premium" data-theme="WAVE">
  <!-- ===== Global Header ===== -->
  <header class="site-header">
    <a class="brand" href="index.html">16Body<span>Personalities</span></a>

    <!-- PC -->
    <nav class="nav-links">
      <a href="index.html" class="chip-btn">ãƒˆãƒƒãƒ—</a>
      <a href="gallery.html" class="chip-btn">ã‚¿ã‚¤ãƒ—ã‚®ãƒ£ãƒ©ãƒªãƒ¼</a>
      <a href="contact.html" class="chip-btn">ãŠå•ã„åˆã‚ã›</a>
    </nav>

    <!-- SP -->
    <button class="hamburger" id="navOpen" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼" aria-controls="drawer" aria-expanded="false">
      <svg width="26" height="26" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
  </header>

  <!-- Drawer -->
  <aside class="drawer" id="drawer" aria-hidden="true">
    <div class="drawer-head">
      <span class="drawer-brand">16BodyPersonalities</span>
      <button class="drawer-close" id="navClose" aria-label="é–‰ã˜ã‚‹">
        <svg width="26" height="26" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    <nav class="drawer-links">
      <a href="index.html" class="drawer-item">ãƒˆãƒƒãƒ—</a>
      <a href="app.html" class="drawer-item">è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹</a>
      <a href="gallery.html" class="drawer-item">ã‚¿ã‚¤ãƒ—ã‚®ãƒ£ãƒ©ãƒªãƒ¼</a>
      <a href="privacy.html" class="drawer-item">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼</a>
      <a href="terms.html" class="drawer-item">åˆ©ç”¨è¦ç´„</a>
      <a href="contact.html" class="drawer-item">ãŠå•ã„åˆã‚ã›</a>
    </nav>
  </aside>

  <!-- overlay + spacer -->
  <div class="scrim" id="scrim" hidden></div>
  <div class="topbar-spacer"></div>

  <!-- ===== Premium main ===== -->
  <header class="site" style="display:none"><!-- æ—§ãƒ—ãƒ¬ãƒŸã‚¢ãƒ è¦‹å‡ºã—ã¯éè¡¨ç¤ºã«ã—ã¦ãŠãï¼ˆé‡è¤‡å›é¿ï¼‰ --></header>

  <div class="wrap" id="app"></div>

  <main id="premium-root" class="grid" style="margin-top:10px">
    <div class="card">
      <h2>èª­ã¿è¾¼ã¿ä¸­â€¦</h2>
      <p class="muted">å°‚ç”¨ãƒªãƒ³ã‚¯ï¼ˆtokenï¼‰ã‹ã‚‰å®Œå…¨ç‰ˆãƒ¬ãƒãƒ¼ãƒˆã‚’å¾©å…ƒã—ã¦ã„ã¾ã™ã€‚</p>
    </div>
  </main>

  <footer class="footer">
    <span>Â© 2025 16BodyPersonalities Project</span>
    <span class="muted">This report is personalized for you.</span>
  </footer>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <!-- GAS -->
  <script>const GAS_URL="https://script.google.com/macros/s/AKfycby2H5KNrr2prVQqs4pNCWTmw2U0FJ-_dDs6wg0A6qWsV9JjujZLGvvbBIn14Xt34RpO/exec";</script>
  <script>window.__RESULT_MOUNT__='premium-root';</script>

  <!-- data & renderer -->
  <script src="./meta.js?v=1"></script>
  <script src="./resultView.js?v=2"></script>
  <script src="./tips.personalized.js?v=1"></script>

  <!-- drawer JS (index ã¨åŒã˜) -->
  <script>
    window.addEventListener('DOMContentLoaded', function(){
      const openBtn  = document.getElementById('navOpen');
      const closeBtn = document.getElementById('navClose');
      const drawer   = document.getElementById('drawer');
      const scrim    = document.getElementById('scrim');
      if(!openBtn||!closeBtn||!drawer||!scrim) return;
      function open(){ drawer.classList.add('open'); drawer.setAttribute('aria-hidden','false'); openBtn.setAttribute('aria-expanded','true'); scrim.hidden=false; document.documentElement.style.overflow='hidden'; }
      function close(){ drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true'); openBtn.setAttribute('aria-expanded','false'); scrim.hidden=true; document.documentElement.style.overflow=''; }
      openBtn.addEventListener('click', open, {passive:true});
      closeBtn.addEventListener('click', close, {passive:true});
      scrim.addEventListener('click', close, {passive:true});
      window.addEventListener('keydown', e=>{ if(e.key==='Escape') close(); });
    });
  </script>
    <!-- ===== premium utilities / tips / boot ===== -->
  <script>
    // --- DOM ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
    const $ = (sel, root=document) => root.querySelector(sel);

    // --- JSONPï¼ˆGASã®GETã§ä½¿ç”¨ï¼‰
    function jsonp(url){
      return new Promise((resolve, reject)=>{
        const cb = '__jp' + Math.random().toString(36).slice(2);
        const s  = document.createElement('script');
        const q  = (url.includes('?') ? '&' : '?') + 'callback=' + cb;
        window[cb] = (data)=>{ resolve(data); cleanup(); };
        s.onerror  = ()=>{ reject(new Error('JSONP failed')); cleanup(); };
        s.src = url + q;
        s.async = true;
        document.head.appendChild(s);
        function cleanup(){ try{ delete window[cb]; }catch(_){} s.remove(); }
      });
    }

    // --- åŒæ„ï¼ˆå¿…è¦ãªã‚‰æœ¬ä½“ã¨æƒãˆã‚‹ï¼‰
    const getConsent = () => localStorage.getItem('km_consent') || 'yes';

    // --- åˆæœŸ stateï¼ˆanswers ã¯ token å¾©å…ƒæ™‚ã«ä¸Šæ›¸ãï¼‰
    function makeInitialState(){
      const n = (window.QUESTIONS?.frame?.length || 12);
      const init = ()=> Array.from({length:n}, ()=>3);
      return { step:4, answers:{ frame:init(), surface:init(), balance:init(), line:init() } };
    }
    let state = makeInitialState();

    // --- ç”»åƒä¿å­˜
    async function saveAsImage(){
      const root = document.getElementById('premium-root') || document.getElementById('app') || document.body;
      const canvas = await html2canvas(root, {useCORS:true, scale:2});
      const a = document.createElement('a');
      a.href = canvas.toDataURL('image/png');
      a.download = '16BP-premium.png';
      a.click();
    }

    // --- PDFä¿å­˜ï¼ˆA4ç¸¦ï¼‰
    async function saveAsPDF(){
      const { jsPDF } = window.jspdf;
      const root = document.getElementById('premium-root') || document.getElementById('app') || document.body;
      const canvas = await html2canvas(root, {useCORS:true, scale:2});
      const img = canvas.toDataURL('image/png');
      const pdf = new jsPDF({ unit:'mm', format:'a4', orientation:'p' });
      const pageW=210, pageH=297, margin=10;
      const imgW = pageW - margin*2;
      const imgH = canvas.height * imgW / canvas.width;
      pdf.addImage(img, 'PNG', margin, margin, imgW, Math.min(imgH, pageH - margin*2));
      pdf.save('16BP-premium.pdf');
    }

    // --- è‡ªåˆ†ã«å†é€ï¼ˆãƒ¡ãƒ¼ãƒ«ï¼‰
    async function resendMail(){
      const email = prompt('å®Œå…¨ç‰ˆURLã‚’å†é€ã™ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      if (!email) return;
      let code = '';
      try { code = (typeof buildCode==='function') ? buildCode().code : (window.__PREMIUM_CODE__||''); } catch(_){}
      try{
        const r = await jsonp(`${GAS_URL}?sendMail=1&email=${encodeURIComponent(email)}&code=${encodeURIComponent(code||'')}`);
        if (!r?.ok) throw new Error(r?.error || 'é€ä¿¡å¤±æ•—');
        alert('é€ä¿¡ã—ã¾ã—ãŸï¼è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ã‚‚ã”ç¢ºèªãã ã•ã„ã€‚');
      }catch(e){
        alert('ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚¨ãƒ©ãƒ¼ï¼š' + (e?.message || e));
      }
    }
  </script>

  <!-- ===== personalized tips override ===== -->
  <script>
    (function(){
      // resultView.js ã® axisPercent ãŒç„¡ã„å ´åˆã®ä¿é™º
      function _axisPercent(axisKey){
        if (typeof window.axisPercent === 'function') return window.axisPercent(axisKey);
        return { pct: 50 };
      }

      const TIP_RULES = {
        frame: [
          { when:p=>p>=70, add:{
            diet_do:["é«˜ãŸã‚“ã±ãï¼‹ä½è„‚è³ªã‚’ä¸­å¿ƒã«ã€é£Ÿäº‹ã¯é¢ã§æ‘‚ã‚‹ï¼ˆæ±ç‰©ï¼‹å‰¯èœã§æº€è…¹åº¦ï¼‰"],
            train_cardio:["LSDï¼ˆ30â€“45åˆ†ï¼‰ã‚’é€±2ã€œ3ã€‚é–¢ç¯€ã«å„ªã—ã„è² è·ã§ç¶™ç¶š"],
            care:["è‚©ç”²éª¨ã¾ã‚ã‚Šã®å¯å‹•åŸŸUPï¼ˆYå­—ã‚¹ãƒˆãƒ¬ãƒƒãƒ/å£å¤©ä½¿ï¼‰ã‚’æ¯æ—¥3åˆ†"],
            quick:"å¤œã®ç‚­æ°´åŒ–ç‰©ã¯ä½GIã«å¯„ã›ã‚‹ã ã‘ã§ç¿Œæœã®ã‚€ãã¿ãŒè»½ããªã‚‹"
          }},
          { when:p=>p<=30, add:{
            diet_do:["Mg/K ã‚’æ„è­˜ã€‚æµ·è—»/è±†/ãƒŠãƒƒãƒ„ã‚’æ¯æ—¥å°‘é‡"],
            train_strength:["è‡ªé‡ï¼‹PNFã‚¹ãƒˆãƒ¬ãƒƒãƒã§â€œéª¨â€ã®å¯å‹•åŸŸã‚’åºƒã’ã‚‹â†’å§¿å‹¢ã‚’æ•´ãˆã‚‹"],
            mobility:["èƒ¸éƒ­ã®å‘¼å¸ï¼ˆ4-4-8ï¼‰ã§ä½“å¹¹ã®å®‰å®šæ„ŸUP"],
            quick:"â€œå™›ã‚€å›æ•°â€ã‚’å¢—ã‚„ã—ã¦å’€åš¼ç”±æ¥ã®ä½“å¹¹æ´»æ€§ã‚’èª˜ç™º"
          }},
        ],
        surface: [
          { when:p=>p>=70, add:{
            lines:["ç¸¦ã«1æœ¬â€œå¼·ã„ç·šâ€ï¼ˆã‚»ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ¬ã‚¹/å‰ç«‹ã¦/ãƒ­ãƒ³ã‚°ãƒãƒƒã‚¯ãƒ¬ã‚¹ï¼‰ã‚’ç½®ã"],
            care:["ãƒ’ãƒƒãƒ—ãƒãƒ³ã‚¬ãƒ¼å›é¿ã€‚ãƒ™ãƒ«ãƒˆä½ç½®ã§â€œé¢ã®åˆ†ç¯€â€ã‚’ä½œã‚‹"],
            quick:"ã‚¢ã‚¦ã‚¿ãƒ¼ã¯â€œä¸ˆã§æ”¯é…â€ã€‚ãƒ’ãƒƒãƒ—ä¸­é–“ã€œä¸‹ã§è¿·ã£ãŸã‚‰ä¸‹ã‚’é¸ã¶"
          }},
          { when:p=>p<=30, add:{
            lines:["ã‚µã‚¤ãƒ‰ã¸é€ƒã™ãƒ‰ãƒ¬ãƒ¼ãƒ—/æ¯”ç¿¼ã®è»½ã•ã§ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ç‹­ãè¦‹ã›ã‚‹"],
            train_strength:["å¤–è»¢ç­‹/ä¸­æ®¿ç­‹ï¼ˆã‚¯ãƒ©ãƒ ã‚·ã‚§ãƒ«20å›Ã—2ï¼‰ã§è…°å¹…ã®è¦‹ãˆã‚’è£œæ­£"],
            quick:"ä¸Šã¯çŸ­ããƒ»ä¸‹ã¯è½ã¡æ„Ÿã§â€œYå­—â€ã‚’æ„è­˜ï¼ˆè¦–è¦šé‡å¿ƒâ†“ï¼‰"
          }},
        ],
        balance: [
          { when:p=>p>=70, add:{
            lines:["V/ãƒœãƒ¼ãƒˆ/æ·±ã‚ã®Uã§é–éª¨ã€œèƒ¸å…ƒã«â€œé€ƒã’â€ã‚’ä½œã‚‹"],
            train_strength:["åºƒèƒŒç­‹/åƒ§å¸½ä¸­éƒ¨ï¼ˆãƒ©ãƒƒãƒˆãƒ—ãƒ«/ãƒ•ã‚§ã‚¤ã‚¹ãƒ—ãƒ«ï¼‰ã§åšã¿ã‚’æ•´ãˆã‚‹"],
            quick:"ãƒˆãƒƒãƒ—ã‚¹ã¯å‰ã ã‘INã§è„šé•·ã«ã€è…¹éƒ¨ã®åšã¿ã¯è¦‹ã›ãªã„"
          }},
          { when:p=>p<=30, add:{
            lines:["ãƒã‚¤ã‚¦ã‚¨ã‚¹ãƒˆï¼‹è½ã¡æ„Ÿã§â€œè„šé•·ï¼è„šå¹…â€ã®å°è±¡ã‚’æœ€å„ªå…ˆ"],
            care:["è…¸è…°ç­‹ã‚¹ãƒˆãƒ¬ãƒƒãƒã§éª¨ç›¤å‰å‚¾ã‚’å¾®ä¿®æ­£â†’ä¸‹é‡å¿ƒã®ãƒ€ãƒ«ã•è§£æ¶ˆ"],
            quick:"é´ã¯ç”²æµ…/ã‚„ã‚„å°–ã‚Šã§â€œè¶³ã®ç·šã‚’é•·ãâ€è¦‹ã›ã‚‹"
          }},
        ],
        line: [
          { when:p=>p>=70, add:{
            lines:["ã‚»ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ¬ã‚¹/ç›´ç·šåˆ‡æ›¿/æ¯”ç¿¼ï¼šæ›²ç·šã‚’â€œç›¸æ®ºâ€ã™ã‚‹ç›´ç·šã‚’1ã¤"],
            accessories:["è§’ã®ã‚ã‚‹é‡‘å±/ã‚·ãƒ£ãƒ¼ãƒ—ãªçŸ©å½¢ã§ç·šã‚’å¼·èª¿"],
            quick:"æŸ„ã¯ãƒ”ãƒ³ã‚¹ãƒˆ/ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒšãƒ³ãªã©â€œç´°ã„ç›´ç·šâ€ã‚’é¸ã¶"
          }},
          { when:p=>p<=30, add:{
            lines:["ãƒã‚¤ã‚¢ã‚¹/ã‚®ãƒ£ã‚¶ãƒ¼ã¯â€œ1ç®‡æ‰€ã ã‘â€ã«é™å®šã—ã¦åºƒãŒã‚Šéãã‚’é˜²ã"],
            accessories:["ä¸¸ã¿/å°ç²’/é€ã‘ç´ æã§ç¡¬ã•ã‚’ç·©å’Œ"],
            quick:"è¥Ÿã¯ãƒ©ã‚¦ãƒ³ãƒ‰/ãƒãƒ¼ãƒˆ/ã‚¹ã‚«ãƒ¼ãƒ•ã‚¿ã‚¤ã®â€œ1ã¤â€ã§ååˆ†"
          }},
        ],
      };

      function buildPersonalizedTips(code){
        const base = (window.BODY_TIPS && window.BODY_TIPS[code]) || {};
        const add  = { diet_do:[], diet_avoid:[], train_strength:[], train_cardio:[], mobility:[], care:[], lines:[], accessories:[], quick:[] };

        const pf=_axisPercent('frame').pct, ps=_axisPercent('surface').pct, pb=_axisPercent('balance').pct, pl=_axisPercent('line').pct;
        const apply=(list,pct)=>{ if(!list) return; for(const r of list){ try{ if(r.when(pct)){ for(const k in r.add){ const v=r.add[k]; Array.isArray(v)?add[k].push(...v):add[k].push(v); } } }catch(_){} } };

        apply(TIP_RULES.frame,pf); apply(TIP_RULES.surface,ps); apply(TIP_RULES.balance,pb); apply(TIP_RULES.line,pl);

        const uniq = arr => Array.from(new Set((arr||[]).filter(Boolean)));
        return {
          goal: base.goal||"",
          diet_do: uniq([...(base.diet_do||[]), ...add.diet_do]),
          diet_avoid: uniq([...(base.diet_avoid||[]), ...add.diet_avoid]),
          train_strength: uniq([...(base.train_strength||[]), ...add.train_strength]),
          train_cardio: uniq([...(base.train_cardio||[]), ...add.train_cardio]),
          mobility: uniq([...(base.mobility||[]), ...add.mobility]),
          care: uniq([...(base.care||[]), ...add.care]),
          lines: uniq([...(base.lines||[]), ...add.lines]),
          accessories: uniq([...(base.accessories||[]), ...add.accessories]),
          quick: (base.quick || add.quick[0] || "")
        };
      }

      // resultView.js ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ HTML ç”Ÿæˆã‚’å·®ã—æ›¿ãˆ
      window.renderBodyTipsHTML = function(code){
        const t = buildPersonalizedTips(code);
        const li = arr => (arr||[]).map(x=>`<li>â€¢ ${x}</li>`).join('');
        const pastel = { BN:"#ffd6e8", BW:"#ffe8d6", MN:"#e8ffd6", MW:"#d6f3ff", B:"#f8e1ff", M:"#fff5d6" }[code.slice(0,2)] || "#f0f0f0";
        return `
        <div class="card cute-tips" style="--tone:${pastel}">
          <h3>ğŸ’– Body Balance Tipsï¼ˆã‚ãªãŸå‘ã‘ï¼‰</h3>
          ${t.goal ? `<p class="goal">ğŸ¯ ${t.goal}</p>` : ""}
          <div class="tips-row">
            <div class="tips-col">
              <h4>ğŸ é£Ÿäº‹</h4>
              ${t.diet_do?.length ? `<p class="label">é£Ÿã¹ã‚‹ã¹ãï¼</p><ul>${li(t.diet_do)}</ul>` : ""}
              ${t.diet_avoid?.length ? `<p class="label">é¿ã‘ã‚‹ã¹ãï¼</p><ul>${li(t.diet_avoid)}</ul>` : ""}
              ${t.accessories?.length ? `<p class="label">ã‚¢ã‚¯ã‚»/å°ç‰©</p><ul>${li(t.accessories)}</ul>` : ""}
            </div>
            <div class="tips-col">
              <h4>ğŸƒâ€â™€ï¸ é‹å‹•ãƒ»ãƒ©ã‚¤ãƒ³è¨­è¨ˆ</h4>
              ${t.train_strength?.length ? `<p class="label">ç­‹ãƒˆãƒ¬</p><ul>${li(t.train_strength)}</ul>` : ""}
              ${t.train_cardio?.length ? `<p class="label">æœ‰é…¸ç´ </p><ul>${li(t.train_cardio)}</ul>` : ""}
              ${t.lines?.length ? `<p class="label">ãƒ©ã‚¤ãƒ³è¨­è¨ˆ</p><ul>${li(t.lines)}</ul>` : ""}
            </div>
          </div>
          ${(t.mobility?.length || t.care?.length) ? `
            <div class="tips-extra">
              <h4>ğŸ§˜â€â™€ï¸ ã‚±ã‚¢ãƒ»å§¿å‹¢</h4>
              <ul>${li(t.mobility)}${li(t.care)}</ul>
            </div>` : ``}
          ${t.quick ? `<p class="quick"><b>âœ¨Quick Winï¼š</b>${t.quick}</p>` : ""}
        </div>`;
      };

      window.__personalizedTipsApplied = true;
    })();
  </script>

  <!-- ===== boot: token å¾©å…ƒ â†’ resultView ã§æç”» ===== -->
  <script>
    // çµæœå·®ã—è¾¼ã¿å…ˆã¯ä¸Šã§æŒ‡å®šæ¸ˆã¿ï¼š window.__RESULT_MOUNT__ = 'premium-root'

    async function boot(){
      const root = document.getElementById('premium-root') || document.getElementById('app') || document.body;

      const token = new URLSearchParams(location.search).get('token');
      if (!token){
        root.innerHTML = `
          <div class="card">
            <h2>ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</h2>
            <p class="muted">URLã® <code>?token=...</code> ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
          </div>`;
        return;
      }

      // GAS: /exec?report=1&token=...
      let res;
      try{
        res = await jsonp(`${GAS_URL}?report=1&token=${encodeURIComponent(token)}`);
      }catch(e){
        root.innerHTML = `
          <div class="card">
            <h2>èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</h2>
            <p class="muted">${e?.message || e}</p>
          </div>`;
        return;
      }

      if (!res?.ok || !res?.data){
        root.innerHTML = `
          <div class="card">
            <h2>å¾©å…ƒã‚¨ãƒ©ãƒ¼</h2>
            <p class="muted">${res?.error || 'token ã«å¯¾å¿œã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚'}</p>
          </div>`;
        return;
      }

      // state æ³¨å…¥
      state = makeInitialState();
      if (res.data.answers) state.answers = res.data.answers;
      window.__PREMIUM_CODE__   = res.data.code   || '';
      window.__PREMIUM_SCORES__ = res.data.scores || {};
      // ===== Premium: ä¿å­˜çµæœãƒ­ãƒƒã‚¯ï¼ˆå†è¨ˆç®—ã•ã›ãªã„ï¼‰ =====
(function lockPremiumResult(){
  if (!window.__PREMIUM_CODE__) return;

  const snap = {
    code:    window.__PREMIUM_CODE__,
    scores:  window.__PREMIUM_SCORES__ || {},
    answers: (window.state && state.answers) || {}
  };

  window.__LOCK_RESULT__ = true;
  window.__PREMIUM_ANSWERS__ = snap.answers;

  // buildCode ã‚’å·®ã—æ›¿ãˆï¼ˆä¿å­˜æ¸ˆã¿ã‚’ãã®ã¾ã¾è¿”ã™ï¼‰
  const _origBuild = window.buildCode;
  window.buildCode = function(){
    if (window.__LOCK_RESULT__) {
      return { code: snap.code, scores: snap.scores, answers: snap.answers };
    }
    return _origBuild ? _origBuild() : { code:'', scores:{}, answers:{} };
  };

  // axisPercent ã‚‚å·®ã—æ›¿ãˆï¼ˆä¿å­˜ã•ã‚ŒãŸ mean â†’ %ï¼‰
  const _origAxis = window.axisPercent;
  window.axisPercent = function(axisKey){
    const mean = snap.scores?.[axisKey]?.mean;
    if (window.__LOCK_RESULT__ && typeof mean === 'number') {
      const pct = Math.max(0, Math.min(100, Math.round((mean - 1) / 4 * 100)));
      const ax  = (window.AXES || []).find(a => a.key === axisKey);
      const sideLabel = ax ? (pct > 50 ? ax.posLabel : ax.negLabel) : '';
      return { pct, sideLabel, posSide: pct > 50 };
    }
    return _origAxis ? _origAxis(axisKey) : { pct:50, sideLabel:'', posSide:false };
  };

  console.log('[premium-lock] locked to snapshot:', snap.code, snap.scores);
})();

      // app ã¨åŒã˜ãƒ¬ãƒ³ãƒ€ãƒ©ã§æç”»ï¼ˆrenderResult or _renderResultCoreï¼‰
      if (typeof renderResult === 'function') {
        renderResult();
      } else if (typeof _renderResultCore === 'function') {
        _renderResultCore();
      } else {
        root.innerHTML = `
          <div class="card">
            <h2>çµæœãƒ“ãƒ¥ãƒ¼ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“</h2>
            <p class="muted">resultView.js ã®ãƒ‘ã‚¹/èª­ã¿è¾¼ã¿é †ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
          </div>`;
        return;
      }

      // ãƒ„ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ï¼ˆå­˜åœ¨ã™ã‚Œã°ï¼‰
      document.getElementById('btn-save-img') ?.addEventListener('click', saveAsImage, {passive:true});
      document.getElementById('btn-save-pdf') ?.addEventListener('click', saveAsPDF,   {passive:true});
      document.getElementById('btn-send-mail')?.addEventListener('click', resendMail,  {passive:true});
    }

    // èµ·å‹•
    window.addEventListener('DOMContentLoaded', boot);
  </script>
  <!-- donut stroke gradient (once) -->
<svg width="0" height="0" style="position:absolute">
  <defs>
    <linearGradient id="grad-donut" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%"  stop-color="#ffd3ec"/>
      <stop offset="50%" stop-color="#f19ac2"/>
      <stop offset="100%" stop-color="#d28cff"/>
    </linearGradient>
  </defs>
</svg>

  <!-- ä»¥é™ï¼šã‚ãªãŸã® premium ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆboot(), jsonp ãªã©ï¼‰ãã®ã¾ã¾ -->
  <!-- â˜…æ—¢å­˜ã® boot() ãƒ–ãƒ­ãƒƒã‚¯ã¯ã“ã®ä¸‹ã«ç½®ã„ã¦OKï¼ˆå¤‰æ›´ä¸è¦ï¼‰ -->
</body>