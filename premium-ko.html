<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="color-scheme" content="dark light"/>
  <title>ì™„ì „íŒ ë¦¬í¬íŠ¸ | 16BodyPersonalities</title>

  <link rel="icon" href="data:,">

  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="./styles.css?v=2"/>
  <link rel="stylesheet" href="./premium.css?v=1"/>
  <style>
  body {
    background:#fafafa;
    font-family:"Inter", -apple-system, BlinkMacSystemFont, sans-serif;
  }
  .premium-wrap {
    max-width: 860px;
    margin: 0 auto;
    padding: 24px;
  }

  .hero {
    text-align:center;
    padding:24px 0;
  }
  .hero img.logo {
    width:140px;
    opacity:1;
    transition: opacity .4s;
  }

  .hero h1 {
    margin-top:12px;
    font-size:28px;
    font-weight:800;
    color:#222;
  }

  /* ê²°ê³¼ ë¸”ë¡ ê³ ê¸‰í™” */
  .premium-card {
    background:white;
    border-radius:20px;
    padding:28px;
    margin-top:24px;
    box-shadow:0 6px 20px rgba(0,0,0,0.08);
  }

  /* ì´ë¯¸ì§€ê°€ ê²€ì€ ë°°ê²½ì´ ë˜ì§€ ì•Šë„ë¡ */
  .type-image {
    width:100%;
    background:white;
    border-radius:20px;
    margin:16px 0;
  }

  /* Body Tips ì¹´ë“œ ë°°ê²½ */
  .cute-tips {
    background:white;
    border:1px solid #eee;
    border-radius:18px;
  }

  /* ì œëª© ì¡°ì • */
  .premium-card h2 {
    font-size:22px;
    color:#222;
    font-weight:700;
    margin-bottom:12px;
  }

  .premium-card h3,
  .cute-tips h3 {
    color:#333;
    font-weight:700;
  }

  .tips-col h4 {
    color:#444;
  }

  .goal,
  .label,
  li,
  p {
    color:#333;
  }
</style>
</head>

<body data-page="premium" data-theme="WAVE">
  <header class="site-header">
    <a class="brand" href="index-ko.html">16Body<span>Personalities</span></a>

    <nav class="nav-links">
      <a href="index-ko.html" class="chip-btn">í™ˆ</a>
      <a href="gallery-ko.html" class="chip-btn">íƒ€ì… ê°¤ëŸ¬ë¦¬</a>
      <a href="contact-ko.html" class="chip-btn">ë¬¸ì˜í•˜ê¸°</a>
    </nav>

    <button class="hamburger" id="navOpen" aria-label="ë©”ë‰´" aria-controls="drawer" aria-expanded="false">
      <svg width="26" height="26" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
  </header>

  <aside class="drawer" id="drawer" aria-hidden="true">
    <div class="drawer-head">
      <span class="drawer-brand">16BodyPersonalities</span>
      <button class="drawer-close" id="navClose" aria-label="ë‹«ê¸°">
        <svg width="26" height="26" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    <nav class="drawer-links">
      <a href="index-ko.html" class="drawer-item">í™ˆ</a>
      <a href="app-ko.html" class="drawer-item">ì§„ë‹¨ ì‹œì‘í•˜ê¸°</a>
      <a href="gallery-ko.html" class="drawer-item">íƒ€ì… ê°¤ëŸ¬ë¦¬</a>
      <a href="privacy-ko.html" class="drawer-item">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
      <a href="terms-ko.html" class="drawer-item">ì´ìš©ì•½ê´€</a>
      <a href="contact-ko.html" class="drawer-item">ë¬¸ì˜í•˜ê¸°</a>
    </nav>
  </aside>

  <div class="scrim" id="scrim" hidden></div>
  <div class="topbar-spacer"></div>

  <header class="site" style="display:none"></header>

  <div class="wrap" id="app"></div>

  <main id="premium-root" class="grid" style="margin-top:10px">
    <div class="card">
      <h2>ë¡œë”© ì¤‘â€¦</h2>
      <p class="muted">ì „ìš© ë§í¬(token)ì—ì„œ ì™„ì „íŒ ë¦¬í¬íŠ¸ë¥¼ ë³µì›í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
    </div>
  </main>

  <footer class="footer">
    <span>Â© 2025 16BodyPersonalities Project</span>
    <span class="muted">This report is personalized for you.</span>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <script>const API_URL="https://uk952hkt2e.execute-api.ap-northeast-1.amazonaws.com/prod";</script>
  <script>window.__RESULT_MOUNT__='premium-root';</script>

  <script src="./meta-ko.js?v=1"></script>
  <script src="./resultView-ko.js?v=2"></script>
  <script src="./tips.personalized-ko.js?v=1"></script>

  <script>
    window.addEventListener('DOMContentLoaded', function(){
      const openBtn  = document.getElementById('navOpen');
      const closeBtn = document.getElementById('navClose');
      const drawer   = document.getElementById('drawer');
      const scrim    = document.getElementById('scrim');
      if(!openBtn||!closeBtn||!drawer||!scrim) return;
      function open(){ drawer.classList.add('open'); drawer.setAttribute('aria-hidden','false'); openBtn.setAttribute('aria-expanded','true'); scrim.hidden=false; document.documentElement.style.overflow='hidden'; }
      function close(){ drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true'); openBtn.setAttribute('aria-expanded','false'); scrim.hidden=true; document.documentElement.style.overflow=''; }
      openBtn.addEventListener('click', open, {passive:true});
      closeBtn.addEventListener('click', close, {passive:true});
      scrim.addEventListener('click', close, {passive:true});
      window.addEventListener('keydown', e=>{ if(e.key==='Escape') close(); });
    });
  </script>
    <script>
    // --- DOM ë‹¨ì¶•
    const $ = (sel, root=document) => root.querySelector(sel);

    // --- JSONP (GASì˜ GETìš©)
    function jsonp(url){
      return new Promise((resolve, reject)=>{
        const cb = '__jp' + Math.random().toString(36).slice(2);
        const s  = document.createElement('script');
        const q  = (url.includes('?') ? '&' : '?') + 'callback=' + cb;
        window[cb] = (data)=>{ resolve(data); cleanup(); };
        s.onerror  = ()=>{ reject(new Error('JSONP failed')); cleanup(); };
        s.src = url + q;
        s.async = true;
        document.head.appendChild(s);
        function cleanup(){ try{ delete window[cb]; }catch(_){} s.remove(); }
      });
    }

    // --- ë™ì˜
    const getConsent = () => localStorage.getItem('km_consent') || 'yes';

    // --- ì¬ì‹œë„ í¬í•¨ fetch
    async function fetchWithRetry(url, options = {}, retries = 3, delay = 1000) {
      for (let i = 0; i < retries; i++) {
        try {
          const response = await fetch(url, options);
          if (response.status >= 500 && i < retries - 1) {
            console.log(`[Retry] ${i + 1}/${retries - 1} after ${delay}ms (status: ${response.status})`);
            await new Promise(resolve => setTimeout(resolve, delay));
            delay *= 2;
            continue;
          }
          return response;
        } catch (error) {
          if (i < retries - 1) {
            console.log(`[Retry] ${i + 1}/${retries - 1} after ${delay}ms (error: ${error.message})`);
            await new Promise(resolve => setTimeout(resolve, delay));
            delay *= 2;
            continue;
          }
          throw error;
        }
      }
    }

    // --- ì´ˆê¸° state
    function makeInitialState(){
      const n = (window.QUESTIONS?.frame?.length || 12);
      const init = ()=> Array.from({length:n}, ()=>3);
      return { step:4, answers:{ frame:init(), surface:init(), balance:init(), line:init() } };
    }
    let state = makeInitialState();

    // --- ì´ë¯¸ì§€ ì €ì¥
    async function saveAsImage(){
      const root = document.getElementById('premium-root') || document.getElementById('app') || document.body;
      const canvas = await html2canvas(root, {useCORS:true, scale:2});
      const a = document.createElement('a');
      a.href = canvas.toDataURL('image/png');
      a.download = '16BP-premium.png';
      a.click();
    }

    // --- PDF ì €ì¥ (A4 ì„¸ë¡œ)
    async function saveAsPDF(){
      const { jsPDF } = window.jspdf;
      const root = document.getElementById('premium-root') || document.getElementById('app') || document.body;
      const canvas = await html2canvas(root, {useCORS:true, scale:2});
      const img = canvas.toDataURL('image/png');
      const pdf = new jsPDF({ unit:'mm', format:'a4', orientation:'p' });
      const pageW=210, pageH=297, margin=10;
      const imgW = pageW - margin*2;
      const imgH = canvas.height * imgW / canvas.width;
      pdf.addImage(img, 'PNG', margin, margin, imgW, Math.min(imgH, pageH - margin*2));
      pdf.save('16BP-premium.pdf');
    }

    // --- ìì‹ ì—ê²Œ ì¬ì „ì†¡ (ë©”ì¼)
    async function resendMail(){
      const email = prompt('ì™„ì „íŒ URLì„ ë‹¤ì‹œ ë°›ì„ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
      if (!email) return;
      let code = '';
      try { code = (typeof buildCode==='function') ? buildCode().code : (window.__PREMIUM_CODE__||''); } catch(_){}
      try{
        const res = await fetchWithRetry(`${API_URL}/premium/resend`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, code: code || '' })
        });
        const r = await res.json();
        if (!r?.ok) throw new Error(r?.error || 'ì „ì†¡ ì‹¤íŒ¨');
        alert('ì „ì†¡í–ˆìŠµë‹ˆë‹¤! ìŠ¤íŒ¸ ë©”ì¼í•¨ë„ í™•ì¸í•´ ì£¼ì„¸ìš”.');
      }catch(e){
        alert('ë©”ì¼ ì „ì†¡ ì—ëŸ¬: ' + (e?.message || e));
      }
    }
  </script>

  <script>
    (function(){
      function _axisPercent(axisKey){
        if (typeof window.axisPercent === 'function') return window.axisPercent(axisKey);
        return { pct: 50 };
      }

      const TIP_RULES = {
        frame: [
          { when:p=>p>=70, add:{
            diet_do:["ê³ ë‹¨ë°±+ì €ì§€ë°© ì¤‘ì‹¬ìœ¼ë¡œ, ì‹ì‚¬ëŠ” 'ë©´'ìœ¼ë¡œ ì„­ì·¨ (êµ­ë¬¼+ë°˜ì°¬ìœ¼ë¡œ í¬ë§Œê°)"],
            train_cardio:["LSD (30â€“45ë¶„)ë¥¼ ì£¼ 2~3íšŒ. ê´€ì ˆì— ë¬´ë¦¬ ì—†ëŠ” ë¶€í•˜ë¡œ ì§€ì†"],
            care:["ê²¬ê°‘ê³¨ ì£¼ë³€ ê°€ë™ì—­ UP (Yì ìŠ¤íŠ¸ë ˆì¹­/ì›” ì—”ì ¤) ë§¤ì¼ 3ë¶„"],
            quick:"ì €ë… íƒ„ìˆ˜í™”ë¬¼ì€ ì €GIë¡œ ë°”ê¾¸ê¸°ë§Œ í•´ë„ ë‹¤ìŒ ë‚  ë¶“ê¸°ê°€ ëœí•¨"
          }},
          { when:p=>p<=30, add:{
            diet_do:["Mg/K ì˜ì‹í•˜ê¸°. í•´ì¡°ë¥˜/ì½©/ê²¬ê³¼ë¥˜ë¥¼ ë§¤ì¼ ì†ŒëŸ‰"],
            train_strength:["ë§¨ëª¸+PNF ìŠ¤íŠ¸ë ˆì¹­ìœ¼ë¡œ 'ë¼ˆ'ì˜ ê°€ë™ì—­ ë„“íˆê¸° â†’ ìì„¸ ì •ëˆ"],
            mobility:["í‰ê³½ í˜¸í¡ (4-4-8)ìœ¼ë¡œ ì½”ì–´ ì•ˆì •ê° UP"],
            quick:"'ì”¹ëŠ” íšŸìˆ˜'ë¥¼ ëŠ˜ë ¤ ì €ì‘ ìš´ë™ ìœ ë˜ì˜ ì½”ì–´ í™œì„± ìœ ë„"
          }},
        ],
        surface: [
          { when:p=>p>=70, add:{
            lines:["ì„¸ë¡œë¡œ 'ê°•í•œ ì„ ' í•˜ë‚˜(ì„¼í„° í”„ë ˆìŠ¤/ì•ë‹¨/ë¡± ëª©ê±¸ì´)ë¥¼ ë°°ì¹˜"],
            care:["ê³¨ë°˜ë°”ì§€(í™í–‰ê±°) íšŒí”¼. ë²¨íŠ¸ ìœ„ì¹˜ë¡œ 'ë©´ì˜ ë¶„ì ˆ'ì„ ë§Œë“¦"],
            quick:"ì•„ìš°í„°ëŠ” 'ê¸¸ì´ë¡œ ì§€ë°°'. í™ ì¤‘ê°„~ì•„ë˜ì—ì„œ ê³ ë¯¼ë˜ë©´ ê¸´ ìª½ì„ ì„ íƒ"
          }},
          { when:p=>p<=30, add:{
            lines:["ì˜†ìœ¼ë¡œ í˜ë ¤ë³´ë‚´ëŠ” ë“œë ˆì´í”„/íˆë“  ë²„íŠ¼ì˜ ê°€ë²¼ì›€ìœ¼ë¡œ í”„ë ˆì„ì„ ì¢ì•„ ë³´ì´ê²Œ"],
            train_strength:["ì™¸ì „ê·¼/ì¤‘ë‘”ê·¼ (í´ë¨ì‰˜ 20íšŒÃ—2)ìœ¼ë¡œ í—ˆë¦¬ ë„ˆë¹„ ë³´ì •"],
            quick:"ìƒì˜ëŠ” ì§§ê²ŒÂ·í•˜ì˜ëŠ” íë¥´ëŠ” í•ìœ¼ë¡œ 'Yì' ì˜ì‹ (ì‹œê°ì  ì¤‘ì‹¬â†“)"
          }},
        ],
        balance: [
          { when:p=>p>=70, add:{
            lines:["V/ë³´íŠ¸/ê¹Šì€ Uë„¥ìœ¼ë¡œ ì‡„ê³¨~ê°€ìŠ´ì— 'íƒˆì¶œêµ¬' ë§Œë“¤ê¸°"],
            train_strength:["ê´‘ë°°ê·¼/ìŠ¹ëª¨ ì¤‘ë¶€ (ë˜íŠ¸ í’€ ë‹¤ìš´/í˜ì´ìŠ¤ í’€)ë¡œ ë‘ê»˜ê° ì •ëˆ"],
            quick:"ìƒì˜ëŠ” ì•ë§Œ ë„£ì–´ ë‹¤ë¦¬ë¥¼ ê¸¸ê²Œ, ë³µë¶€ ë‘ê»˜ëŠ” ê°ì¶”ê¸°"
          }},
          { when:p=>p<=30, add:{
            lines:["í•˜ì´ì›¨ì´ìŠ¤íŠ¸+ë–¨ì–´ì§€ëŠ” í•ìœ¼ë¡œ 'ë‹¤ë¦¬ ê¸¸ì´>ë‹¤ë¦¬ êµµê¸°' ì¸ìƒì„ ìµœìš°ì„ "],
            care:["ì¥ìš”ê·¼ ìŠ¤íŠ¸ë ˆì¹­ìœ¼ë¡œ ê³¨ë°˜ ì „ê²½ ë¯¸ì„¸ êµì • â†’ í•˜ì²´ ì¤‘ì‹¬ì˜ ë‚˜ë¥¸í•¨ í•´ì†Œ"],
            quick:"ì‹ ë°œì€ ë°œë“±ì´ ë³´ì´ê³ /ì•½ê°„ ë¾°ì¡±í•œ ê²ƒìœ¼ë¡œ 'ë‹¤ë¦¬ ì„ ì„ ê¸¸ê²Œ' ì—°ì¶œ"
          }},
        ],
        line: [
          { when:p=>p>=70, add:{
            lines:["ì„¼í„° í”„ë ˆìŠ¤/ì§ì„  ì ˆê°œ/íˆë“  ë²„íŠ¼: ê³¡ì„ ì„ 'ìƒì‡„'í•˜ëŠ” ì§ì„  í•˜ë‚˜"],
            accessories:["ê°ì§„ ê¸ˆì†/ìƒ¤í”„í•œ ì‚¬ê°í˜•ìœ¼ë¡œ ì„  ê°•ì¡°"],
            quick:"íŒ¨í„´ì€ í•€ìŠ¤íŠ¸ë¼ì´í”„/ìœˆë„ìš°í˜ì¸ ë“± 'ê°€ëŠ” ì§ì„ ' ì„ íƒ"
          }},
          { when:p=>p<=30, add:{
            lines:["ë°”ì´ì–´ìŠ¤/ì…”ë§ì€ 'í•œ ê³³ì—ë§Œ' í•œì •í•´ ì§€ë‚˜ì¹œ í¼ì§ ë°©ì§€"],
            accessories:["ë‘¥ê·¼/ì‘ì€/íˆ¬ëª… ì†Œì¬ë¡œ ë”±ë”±í•¨ ì™„í™”"],
            quick:"ì¹´ë¼ëŠ” ë¼ìš´ë“œ/í•˜íŠ¸/ìŠ¤ì¹´í”„ íƒ€ì´ ì¤‘ 'í•˜ë‚˜'ë©´ ì¶©ë¶„"
          }},
        ],
      };

      function buildPersonalizedTips(code){
        const base = (window.BODY_TIPS && window.BODY_TIPS[code]) || {};
        const add  = { diet_do:[], diet_avoid:[], train_strength:[], train_cardio:[], mobility:[], care:[], lines:[], accessories:[], quick:[] };

        const pf=_axisPercent('frame').pct, ps=_axisPercent('surface').pct, pb=_axisPercent('balance').pct, pl=_axisPercent('line').pct;
        const apply=(list,pct)=>{ if(!list) return; for(const r of list){ try{ if(r.when(pct)){ for(const k in r.add){ const v=r.add[k]; Array.isArray(v)?add[k].push(...v):add[k].push(v); } } }catch(_){} } };

        apply(TIP_RULES.frame,pf); apply(TIP_RULES.surface,ps); apply(TIP_RULES.balance,pb); apply(TIP_RULES.line,pl);

        const uniq = arr => Array.from(new Set((arr||[]).filter(Boolean)));
        return {
          goal: base.goal||"",
          diet_do: uniq([...(base.diet_do||[]), ...add.diet_do]),
          diet_avoid: uniq([...(base.diet_avoid||[]), ...add.diet_avoid]),
          train_strength: uniq([...(base.train_strength||[]), ...add.train_strength]),
          train_cardio: uniq([...(base.train_cardio||[]), ...add.train_cardio]),
          mobility: uniq([...(base.mobility||[]), ...add.mobility]),
          care: uniq([...(base.care||[]), ...add.care]),
          lines: uniq([...(base.lines||[]), ...add.lines]),
          accessories: uniq([...(base.accessories||[]), ...add.accessories]),
          quick: (base.quick || add.quick[0] || "")
        };
      }

      window.renderBodyTipsHTML = function(code){
        const t = buildPersonalizedTips(code);
        const li = arr => (arr||[]).map(x=>`<li>â€¢ ${x}</li>`).join('');
        const pastel = { BN:"#ffd6e8", BW:"#ffe8d6", MN:"#e8ffd6", MW:"#d6f3ff", B:"#f8e1ff", M:"#fff5d6" }[code.slice(0,2)] || "#f0f0f0";
        return `
        <div class="card cute-tips" style="--tone:${pastel}">
          <h3>ğŸ’– Body Balance Tips (ë‹¹ì‹ ë§Œì„ ìœ„í•œ íŒ)</h3>
          ${t.goal ? `<p class="goal">ğŸ¯ ${t.goal}</p>` : ""}
          <div class="tips-row">
            <div class="tips-col">
              <h4>ğŸ ì‹ë‹¨</h4>
              ${t.diet_do?.length ? `<p class="label">ì¶”ì²œ!</p><ul>${li(t.diet_do)}</ul>` : ""}
              ${t.diet_avoid?.length ? `<p class="label">ì£¼ì˜!</p><ul>${li(t.diet_avoid)}</ul>` : ""}
              ${t.accessories?.length ? `<p class="label">ì•¡ì„¸ì„œë¦¬/ì†Œí’ˆ</p><ul>${li(t.accessories)}</ul>` : ""}
            </div>
            <div class="tips-col">
              <h4>ğŸƒâ€â™€ï¸ ìš´ë™Â·ë¼ì¸ ì„¤ê³„</h4>
              ${t.train_strength?.length ? `<p class="label">ê·¼ë ¥ ìš´ë™</p><ul>${li(t.train_strength)}</ul>` : ""}
              ${t.train_cardio?.length ? `<p class="label">ìœ ì‚°ì†Œ</p><ul>${li(t.train_cardio)}</ul>` : ""}
              ${t.lines?.length ? `<p class="label">ë¼ì¸ ì„¤ê³„</p><ul>${li(t.lines)}</ul>` : ""}
            </div>
          </div>
          ${(t.mobility?.length || t.care?.length) ? `
            <div class="tips-extra">
              <h4>ğŸ§˜â€â™€ï¸ ì¼€ì–´Â·ìì„¸</h4>
              <ul>${li(t.mobility)}${li(t.care)}</ul>
            </div>` : ``}
          ${t.quick ? `<p class="quick"><b>âœ¨Quick Win:</b> ${t.quick}</p>` : ""}
        </div>`;
      };

      window.__personalizedTipsApplied = true;
    })();
  </script>

  <script>
    async function boot(){
      const root = document.getElementById('premium-root') || document.getElementById('app') || document.body;

      const token = new URLSearchParams(location.search).get('token');
      if (!token){
        root.innerHTML = `
          <div class="card">
            <h2>í† í°ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h2>
            <p class="muted">URLì˜ <code>?token=...</code> ë¶€ë¶„ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.</p>
          </div>`;
        return;
      }

      let res;
      try{
        const response = await fetchWithRetry(`${API_URL}/premium/${encodeURIComponent(token)}`);
        res = await response.json();
      }catch(e){
        root.innerHTML = `
          <div class="card">
            <h2>ì½ê¸° ì˜¤ë¥˜</h2>
            <p class="muted">${e?.message || e}</p>
          </div>`;
        return;
      }

      if (!res?.ok || !res?.data){
        root.innerHTML = `
          <div class="card">
            <h2>ë³µì› ì˜¤ë¥˜</h2>
            <p class="muted">${res?.error || 'tokenì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}</p>
          </div>`;
        return;
      }

      state = makeInitialState();
      if (res.data.answers) state.answers = res.data.answers;
      window.__PREMIUM_CODE__   = res.data.code   || '';
      window.__PREMIUM_SCORES__ = res.data.scores || {};
      
      // ===== Premium: ê²°ê³¼ ê³ ì • (ì¬ê³„ì‚° ë°©ì§€) =====
      (function lockPremiumResult(){
        if (!window.__PREMIUM_CODE__) return;

        const snap = {
          code:    window.__PREMIUM_CODE__,
          scores:  window.__PREMIUM_SCORES__ || {},
          answers: (window.state && state.answers) || {}
        };

        window.__LOCK_RESULT__ = true;
        window.__PREMIUM_ANSWERS__ = snap.answers;

        const _origBuild = window.buildCode;
        window.buildCode = function(){
          if (window.__LOCK_RESULT__) {
            return { code: snap.code, scores: snap.scores, answers: snap.answers };
          }
          return _origBuild ? _origBuild() : { code:'', scores:{}, answers:{} };
        };

        const _origAxis = window.axisPercent;
        window.axisPercent = function(axisKey){
          const mean = snap.scores?.[axisKey]?.mean;
          if (window.__LOCK_RESULT__ && typeof mean === 'number') {
            const pct = Math.max(0, Math.min(100, Math.round((mean - 1) / 4 * 100)));
            const ax  = (window.AXES || []).find(a => a.key === axisKey);
            const sideLabel = ax ? (pct > 50 ? ax.posLabel : ax.negLabel) : '';
            return { pct, sideLabel, posSide: pct > 50 };
          }
          return _origAxis ? _origAxis(axisKey) : { pct:50, sideLabel:'', posSide:false };
        };
      })();

      if (typeof renderResult === 'function') {
        renderResult();
      } else if (typeof _renderResultCore === 'function') {
        _renderResultCore();
      } else {
        root.innerHTML = `
          <div class="card">
            <h2>ê²°ê³¼ ë·°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h2>
            <p class="muted">resultView.js ê²½ë¡œë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.</p>
          </div>`;
        return;
      }

      document.getElementById('btn-save-img') ?.addEventListener('click', saveAsImage, {passive:true});
      document.getElementById('btn-save-pdf') ?.addEventListener('click', saveAsPDF,   {passive:true});
      document.getElementById('btn-send-mail')?.addEventListener('click', resendMail,  {passive:true});
    }

    window.addEventListener('DOMContentLoaded', boot);
  </script>
  <svg width="0" height="0" style="position:absolute">
  <defs>
    <linearGradient id="grad-donut" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%"  stop-color="#ffd3ec"/>
      <stop offset="50%" stop-color="#f19ac2"/>
      <stop offset="100%" stop-color="#d28cff"/>
    </linearGradient>
  </defs>
</svg>
</body>

</html>